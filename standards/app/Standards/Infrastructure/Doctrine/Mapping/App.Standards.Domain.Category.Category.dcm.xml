<?xml version="1.0" encoding="UTF-8"?>
<doctrine-mapping
	xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping"
	xmlns:gedmo="http://gediminasm.org/schemas/orm/doctrine-extensions-mapping"
>
	<entity
		name="App\Standards\Domain\Category\Category"
		repository-class="Gedmo\Tree\Entity\Repository\NestedTreeRepository"
		table="standards__category"
	>
		<indexes>
			<index fields="treeLeft"/>
			<index fields="externalId"/>
		</indexes>

		<id name="pk" type="integer">
			<generator strategy="AUTO"/>
		</id>

		<field name="id" type="app.standards.category.id" unique="true"/>

		<field name="title"/>

		<field name="externalId" nullable="true"/>

		<field name="metadata" type="json"/>

		<field name="version" type="integer" version="true"/>

		<!-- Gedmo Nested tree -->
		<gedmo:tree type="nested"/>

		<many-to-one
			field="root"
			target-entity="App\Standards\Domain\Category\Category"
		>
			<join-column on-delete="CASCADE"/>
			<gedmo:tree-root/>
		</many-to-one>

		<many-to-one
			field="parent"
			target-entity="App\Standards\Domain\Category\Category"
		>
			<join-column on-delete="CASCADE"/>
			<gedmo:tree-parent/>
		</many-to-one>

		<field name="treeLeft" type="integer">
			<gedmo:tree-left/>
		</field>

		<field name="treeRight" type="integer">
			<gedmo:tree-right/>
		</field>

		<field name="treeLevel" type="integer">
			<gedmo:tree-level/>
		</field>
	</entity>
</doctrine-mapping>
